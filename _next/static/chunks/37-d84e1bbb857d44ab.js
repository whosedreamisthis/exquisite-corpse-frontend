"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[37],{2037:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});var r=n(7876),l=n(4232),o=n(2467),a=n(7378);function s(e){let{gameRoomId:t,message:n,playerCount:s,currentSegmentIndex:i,canDrawOrPlaceLine:c,isWaitingForOtherPlayers:u,receivedCanvasImage:d,previousRedLineY:h,isGameOver:g,finalArtwork:b,finalArtwork2:m,currentPlayersWsId:f,wsRef:x,setMessage:w,handlePlayAgain:v,dynamicCanvasWidth:p,dynamicCanvasHeight:y,backendCanvasHeight:k,setCanDrawOrPlaceLine:j,setIsWaitingForOtherPlayers:C}=e,S=(0,l.useRef)(null),N=(0,l.useRef)(null),D=(0,l.useRef)(null),L=(0,l.useRef)(null),[R,M]=(0,l.useState)(!1),[O,P]=(0,l.useState)(0),[W,z]=(0,l.useState)(0),[E,F]=(0,l.useState)(!1),[A,I]=(0,l.useState)(!1),[Y,T]=(0,l.useState)(y),B=3===i,[H,_]=(0,l.useState)(null);(0,l.useEffect)(()=>{if(console.log("[Overlay Debug] Effect triggered for previousRedLineY scaling."),console.log("[Overlay Debug] Raw previousRedLineY from backend: ".concat(h)),console.log("[Overlay Debug] Current dynamicCanvasHeight: ".concat(y)),console.log("[Overlay Debug] Backend original CanvasHeight: ".concat(k)),null!==h&&k&&y){let e=y/k,t=h*e;_(t),console.log("[Overlay Debug] Calculated scaleFactor: ".concat(e)),console.log("[Overlay Debug] Scaled previousRedLineY: ".concat(t))}else _(null),console.log("[Overlay Debug] previousRedLineY is null or dimensions missing, not applying overlay.")},[h,k,y]),(0,l.useEffect)(()=>{let e=S.current,t=D.current,n=N.current,r=L.current;if(!e||!t)return;e.width=p,e.height=y,t.width=p,t.height=y,n||((n=e.getContext("2d")).lineCap="round",n.strokeStyle="black",n.lineWidth=5,N.current=n),r||(L.current=r=t.getContext("2d"));let l=y/k;if(n.lineWidth=5*l,n.clearRect(0,0,p,y),n.fillStyle="white",n.fillRect(0,0,p,y),r.clearRect(0,0,p,y),d){let e=new Image;e.onload=()=>{N.current&&S.current.width===p&&N.current.drawImage(e,0,0,p,y)},e.onerror=e=>{console.error("Error loading received canvas image:",e)},e.src=d}},[S,D,d,p,y]);let G=(0,l.useCallback)(e=>{let t=D.current,n=L.current;t&&n&&(n.clearRect(0,0,t.width,t.height),n.strokeStyle="red",n.lineWidth=2,n.beginPath(),n.moveTo(0,e),n.lineTo(t.width,e),n.stroke(),n.closePath())},[]),U=(0,l.useCallback)(()=>{let e=D.current,t=L.current;e&&t&&t.clearRect(0,0,e.width,e.height)},[]),X=(0,l.useCallback)((e,t)=>{let n,r;e.preventDefault();let l=t.getBoundingClientRect(),o=t.width/l.width,a=t.height/l.height;return e.touches&&e.touches.length>0?(n=e.touches[0].clientX,r=e.touches[0].clientY):(n=e.clientX,r=e.clientY),{x:(n-l.left)*o,y:(r-l.top)*a}},[]),J=(0,l.useCallback)(e=>{if(!c||g)return;e.preventDefault();let t=D.current;if(!t)return;let{x:n,y:r}=X(e,t);if((!(i>0)||null===H||!(r<H))&&(M(!0),P(n),z(r),!A)){if(!N.current)return;N.current.beginPath(),N.current.moveTo(n,r)}},[c,g,A,X,i,H]),q=(0,l.useCallback)(e=>{if(!R||!c||g)return;e.preventDefault();let t=D.current;if(!t)return;let{x:n,y:r}=X(e,t);if(!(i>0)||null===H||!(r<H)){if(A){let e=Math.max(0,Math.min(y,r));T(e),G(e)}else{if(!N.current)return;N.current.lineTo(n,r),N.current.stroke(),F(!0)}P(n),z(r)}},[R,c,g,A,G,X,y,i,H]),K=(0,l.useCallback)(()=>{c&&!g&&R&&(N.current&&!A&&N.current.closePath(),M(!1))},[c,g,R,A]),Q=(0,l.useCallback)(()=>{R&&!A?K():A&&R&&M(!1)},[R,A,K]),V=(0,l.useCallback)(()=>{if(3!==i){if(!E)return void w("Please draw something before marking as Done.");M(!1),N.current&&N.current.closePath(),I(!0),T(y/2),G(y/2)}},[G,i,y,E,w]),Z=c&&!u&&!g&&(A||B&&E&&!R);return(0,r.jsxs)("div",{className:"w-full max-w-3xl flex flex-col items-center relative",children:[" ",g?(0,r.jsx)(a.default,{finalArtwork:b,finalArtwork2:m,dynamicCanvasWidth:p,dynamicCanvasHeight:y,handlePlayAgain:v}):(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"relative bg-gray-100 rounded-lg shadow-inner overflow-hidden m-[5px]",style:{width:p,height:y},children:[(0,r.jsx)("canvas",{ref:S,className:"absolute top-0 left-0 w-full h-full rounded-lg border-2 border-solid border-gray-400 box-border",style:{zIndex:0}}),(0,r.jsx)("div",{className:"absolute top-1 left-2 p-2 rounded-lg text-gray-800 text-lg font-medium bg-opacity-75 z-40",style:{},children:n}),(0,r.jsx)("div",{className:"absolute top-0 left-0 w-full h-full",style:{width:p,height:y,pointerEvents:"none",zIndex:1},children:d&&i>0&&null!==H&&(0,r.jsx)("div",{className:"absolute top-0 left-0 w-full bg-indigo-300 bg-opacity-75 flex items-center justify-center text-gray-800 text-xl font-semibold",style:{height:"".concat(H,"px"),pointerEvents:"none",overflow:"hidden"},children:"Hidden"})}),(0,r.jsx)("canvas",{ref:D,onMouseDown:J,onMouseMove:q,onMouseUp:K,onMouseOut:Q,onTouchStart:J,onTouchMove:q,onTouchEnd:K,onTouchCancel:K,className:"relative w-full h-full rounded-lg border-2 border-solid border-gray-400 box-border ".concat(c?"cursor-crosshair":"cursor-not-allowed"," touch-none"),style:{zIndex:2}}),u&&(0,r.jsxs)("div",{className:"absolute inset-0 bg-black bg-opacity-70 flex items-center justify-center rounded-lg text-white text-3xl font-bold text-center p-4 z-30",children:["Submitted!",(0,r.jsx)("br",{}),"Waiting for other player to submit their segment..."]}),(0,r.jsx)("div",{className:"absolute bottom-2 right-2 z-40 flex space-x-2",children:(0,r.jsx)(o.default,{clearCanvas:()=>{let e=S.current,t=N.current;if(e&&t&&(t.clearRect(0,0,p,y),d)){let e=new Image;e.onload=()=>{t.drawImage(e,0,0,p,y)},e.src=d}U(),I(!1),T(y),F(!1)},isGameOver:g,canDrawOrPlaceLine:c,handleDoneDrawing:V,isLastSegment:B,canSubmitSegment:Z,submitSegment:()=>{if(!x.current||x.current.readyState!==WebSocket.OPEN)return void w("WebSocket not connected. Cannot submit.");if(!c||u||g||!A&&!B&&E||!E&&!A)return void w("Cannot submit: Not your turn, game over, or conditions not met.");let e=S.current.toDataURL("image/png"),n=null;if(!B&&null!==Y){let e=k/y;n=Math.round(Y*e),console.log("[Submit Debug] Frontend redLineY: ".concat(Y)),console.log("[Submit Debug] Scale factor to backend: ".concat(e)),console.log("[Submit Debug] Normalized redLineY sent to backend: ".concat(n))}x.current.send(JSON.stringify({type:"submitSegment",gameRoomId:t,canvasData:e,redLineY:n,playerId:f})),M(!1),C(!0),j(!1),F(!1),I(!1),U()},isPlacingRedLine:A,isWaitingForOtherPlayers:u,hasDrawnSomething:E,isDrawing:R})})]})})]})}},2467:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var r=n(7876);function l(e){let{clearCanvas:t,isGameOver:n,canDrawOrPlaceLine:l,handleDoneDrawing:o,isLastSegment:a,canSubmitSegment:s,submitSegment:i,isPlacingRedLine:c,isWaitingForOtherPlayers:u,hasDrawnSomething:d,isDrawing:h}=e;return(0,r.jsxs)("div",{className:"game-buttons-container",children:[" ",(0,r.jsxs)("button",{onClick:t,className:"px-2 py-2  text-sm font-bold rounded-lg transition-all duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center\n                                ".concat(l&&!n?"bg-red-500 text-white shadow-lg hover:bg-red-600":"bg-gray-400 cursor-not-allowed shadow-inner"),disabled:!l||n,title:"Clear Canvas",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-7 h-7",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}),(0,r.jsx)("span",{className:"sr-only",children:"Clear Canvas"})," "]}),!a&&!c&&(0,r.jsxs)("button",{onClick:o,className:"px-2 py-2 text-lg font-bold rounded-lg transition-all duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center\n                                        ".concat(!l||u||n||!d||h?"bg-gray-400 cursor-not-allowed shadow-inner":"bg-blue-600 text-white shadow-lg hover:bg-blue-700"),disabled:!l||u||n||!d||h,title:"Done Drawing",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-7 h-7",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsx)("span",{className:"sr-only",children:"Done Drawing"})," "]}),(c||a)&&(0,r.jsxs)("button",{onClick:i,className:"px-3 py-3 text-lg font-bold rounded-lg transition-all duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center\n                                        ".concat(s?"bg-green-600 text-white shadow-lg hover:bg-green-700":"bg-gray-400 cursor-not-allowed shadow-inner"),disabled:!s,title:a?"Submit Final Artwork":"Submit Segment",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-7 h-7",children:a?(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}):(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})}),(0,r.jsx)("span",{className:"sr-only",children:a?"Submit Final Artwork":"Submit Segment"})]})]})}},7378:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var r=n(7876);function l(e){let{finalArtwork:t,finalArtwork2:n,handlePlayAgain:l,dynamicCanvasWidth:o,dynamicCanvasHeight:a}=e;return(0,r.jsxs)("div",{className:"text-center mt-5",children:[(0,r.jsx)("h2",{className:"text-4xl font-extrabold text-purple-700 my-4 animate-bounce",children:"Game Over!"}),(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-8 mb-8",children:[t&&(0,r.jsx)("img",{src:t,alt:"Final Combined Artwork 1",className:"bg-white border-4 border-purple-500 rounded-xl shadow-2xl block",style:{width:o,height:a,objectFit:"contain"}}),n&&(0,r.jsx)("img",{src:n,alt:"Final Combined Artwork 2",className:"bg-white border-4 border-purple-500 rounded-xl shadow-2xl block",style:{width:o,height:a,objectFit:"contain"}})]}),(0,r.jsx)("button",{onClick:l,className:"px-8 py-4 mb-8 text-xl font-bold rounded-lg bg-blue-600 text-white shadow-lg hover:bg-blue-700 transition-colors transform hover:scale-105",children:"Play Again"})]})}}}]);
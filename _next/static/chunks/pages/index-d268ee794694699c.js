(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{1768:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(7876);function a(){return(0,r.jsx)("div",{children:(0,r.jsx)("span",{className:"loader"})})}},2898:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(9843)}])},9475:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(7876);function a(e){let{message:t,gameCode:n,setGameCode:a,createNewGame:o,joinExistingGame:l}=e;return(0,r.jsxs)("div",{className:"mx-4 sm:mx-8 w-full flex flex-col items-center",children:[" ",(0,r.jsx)("h1",{className:"text-5xl font-extrabold text-purple-800 mb-6 drop-shadow-lg text-center",children:"Exquisite Corpse Game"}),(0,r.jsxs)("div",{className:"bg-white p-8 rounded-2xl shadow-xl max-w-md w-full text-center space-y-6",children:[" ",(0,r.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-4",children:"Welcome!"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("button",{onClick:o,className:"w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-purple-500 focus:border-purple-500",children:"Create New Game"}),(0,r.jsxs)("div",{className:"relative flex items-center py-2",children:[(0,r.jsx)("div",{className:"flex-grow border-t border-gray-300"}),(0,r.jsx)("span",{className:"flex-shrink mx-4 text-gray-500 text-lg",children:"OR"}),(0,r.jsx)("div",{className:"flex-grow border-t border-gray-300"})]}),(0,r.jsx)("input",{type:"text",placeholder:"Enter Game Code to Join",value:n,onChange:e=>a(e.target.value.toUpperCase()),className:"w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-purple-500 focus:border-purple-500 uppercase",maxLength:6}),(0,r.jsx)("button",{onClick:l,className:"w-full bg-indigo-600 text-white py-3 rounded-lg text-xl font-bold hover:bg-indigo-700 transition-colors shadow-md",children:"Join Existing Game"})]}),(0,r.jsx)("p",{className:"text-red-500 text-md mt-4",children:t})]})]})}},9843:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var r=n(7876),a=n(4232),o=n(157),l=n(2037),s=n(9475),c=n(1768);let i=["Head","Torso","Legs","Feet"];function u(){let e=(0,a.useRef)(null),[t,n]=(0,a.useState)(""),[u,d]=(0,a.useState)(""),[m,g]=(0,a.useState)(null),[p,x]=(0,a.useState)("Enter a game code to join or create one!"),[h,f]=(0,a.useState)(0),[b,S]=(0,a.useState)(0),[y,w]=(0,a.useState)(i[(b+1)%4]),[v,k]=(0,a.useState)(!1),[C,N]=(0,a.useState)(!1),[j,E]=(0,a.useState)(null),[W,O]=(0,a.useState)(null),[P,I]=(0,a.useState)(!1),[G,L]=(0,a.useState)(null),[A,D]=(0,a.useState)(null),[_,R]=(0,a.useState)(!1),[F,H]=(0,a.useState)(null),[J,M]=(0,a.useState)(0),[T,Y]=(0,a.useState)(0),[z,B]=(0,a.useState)(!1);(0,a.useEffect)(()=>{function e(){{let e,t,n=window.innerWidth-40,r=window.innerHeight-40,a=n/.5625;if(a<=r?(e=n,t=a):(t=r,e=.5625*r),e>1080||t>1920){let n=Math.min(1080/e,1920/t);e*=n,t*=n}M(Math.round(e)),Y(Math.round(t))}}return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),(0,a.useEffect)(()=>{let t=()=>{"visible"===document.visibilityState?(console.log("Browser tab became visible. Checking WebSocket connection..."),_&&(!e.current||e.current.readyState!==WebSocket.OPEN)&&(console.log("WebSocket not open. Attempting to reconnect..."),X())):console.log("Browser tab became hidden.")};return document.addEventListener("visibilitychange",t),()=>{document.removeEventListener("visibilitychange",t)}},[_,u,t,F]);let X=(0,a.useCallback)(()=>{if(_&&(!e.current||e.current.readyState!==WebSocket.OPEN)){console.log("Establishing WebSocket connection..."),e.current&&(e.current.readyState===WebSocket.CONNECTING||e.current.readyState===WebSocket.CLOSING)&&e.current.close(),e.current=null;let r=new WebSocket("wss://satin-lumbar-book.glitch.me");e.current=r;let a=u||t;r.onopen=()=>{console.log("WebSocket re-connected. Sending joinGame message..."),r.send(JSON.stringify({type:"joinGame",gameCode:a,playerId:F})),x("Reconnected to game! Waiting for game state...")},r.onmessage=e=>{let r=JSON.parse(e.data);console.log("Received from server (reconnect):",r),x(r.message),f(r.playerCount||0),S(r.currentSegmentIndex||0),w(i[(r.currentSegmentIndex+1)%4]),k(r.canDraw&&2===r.playerCount&&!r.isWaitingForOthers),N(r.isWaitingForOthers||!1),g(r.gameRoomId||null),r.playerId&&r.playerId!==F&&H(r.playerId),r.hasOwnProperty("canvasData")&&null!==r.canvasData?E(r.canvasData):r.hasOwnProperty("canvasData")&&null===r.canvasData&&E(null),O(0===r.currentSegmentIndex?null:r.previousRedLineY||null),"completed"===r.status?(I(!0),L(r.finalArtwork1||null),D(r.finalArtwork2||null),k(!1),N(!1)):"playerDisconnected"===r.type&&(I(!1),L(null),D(null)),("initialState"===r.type||"gameStarted"===r.type)&&(n(r.gameCode||t),d(r.gameCode||u),N(r.isWaitingForOthers),E(r.canvasData),O(r.previousRedLineY||null),L(r.finalArtwork1||null),D(r.finalArtwork2||null),"completed"===r.status?I(!0):I(!1))},r.onclose=()=>{console.log("WebSocket disconnected during reconnect attempt or normal close."),x("Disconnected from game. Attempting to re-establish connection..."),e.current=null},r.onerror=t=>{console.error("WebSocket error during reconnect:",t),x("WebSocket error. Check console for details. Attempting retry..."),e.current=null}}},[_,u,t,F]);(0,a.useEffect)(()=>(_&&(!e.current||e.current.readyState===WebSocket.CLOSED)&&X(),()=>{e.current&&e.current.readyState===WebSocket.OPEN&&(console.log("Cleaning up WebSocket connection on component unmount or dependency change..."),e.current.close()),e.current=null}),[_,u,t,F,X]);let q=async()=>{try{B(!0);let e=await o.A.post("".concat("https://satin-lumbar-book.glitch.me","/api/createGame"),{});B(!1);let{gameCode:t}=e.data;d(t),n(""),x("Game created! Share this code: ".concat(t)),R(!0)}catch(e){console.error("Error creating game:",e),x("Failed to create game. Please try again.")}},U=(0,a.useCallback)(()=>{e.current&&e.current.readyState===WebSocket.OPEN&&e.current.close(),e.current=null,n(""),d(""),g(null),x("Enter a game code to join or create one!"),f(0),S(0),w(i[1]),k(!1),N(!1),E(null),O(null),I(!1),L(null),D(null),R(!1),H(null)},[]);return(0,r.jsx)("div",{className:"min-h-screen bg-indigo-100 flex flex-col items-center justify-center font-sans px-4 sm:px-8 ".concat(P?"":"overflow-hidden"),children:_?(0,r.jsx)(l.default,{gameRoomId:u||t,message:p,playerCount:h,currentSegmentIndex:b,canDrawOrPlaceLine:v,isWaitingForOtherPlayers:C,receivedCanvasImage:j,previousRedLineY:W,isGameOver:P,finalArtwork:G,finalArtwork2:A,currentPlayersWsId:F,wsRef:e,setMessage:x,setCanDrawOrPlaceLine:k,setIsWaitingForOtherPlayers:N,handlePlayAgain:U,dynamicCanvasWidth:J,dynamicCanvasHeight:T,backendCanvasHeight:1920}):(0,r.jsxs)(r.Fragment,{children:[z&&(0,r.jsx)(c.default,{}),(0,r.jsx)(s.default,{message:p,gameCode:t,setGameCode:n,createNewGame:q,joinExistingGame:()=>{if(""===t.trim())return void x("Please enter a game code to join.");d(""),x("Attempting to join game ".concat(t,"...")),R(!0)}})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[157,37,636,593,792],()=>t(2898)),_N_E=e.O()}]);
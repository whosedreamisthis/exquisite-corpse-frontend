(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{1768:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});var a=n(7876);function r(){return(0,a.jsx)("div",{children:(0,a.jsx)("span",{className:"loader"})})}},2898:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(9843)}])},9475:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});var a=n(7876);function r(e){let{message:t,gameCode:n,setGameCode:r,createNewGame:l,joinExistingGame:s}=e;return(0,a.jsxs)("div",{className:"mx-4 sm:mx-8 w-full flex flex-col items-center",children:[" ",(0,a.jsx)("h1",{className:"text-5xl font-extrabold text-purple-800 mb-6 drop-shadow-lg text-center",children:"Exquisite Corpse Game"}),(0,a.jsxs)("div",{className:"bg-white p-8 rounded-2xl shadow-xl max-w-md w-full text-center space-y-6",children:[" ",(0,a.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-4",children:"Welcome!"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("button",{onClick:l,className:"w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-purple-500 focus:border-purple-500",children:"Create New Game"}),(0,a.jsxs)("div",{className:"relative flex items-center py-2",children:[(0,a.jsx)("div",{className:"flex-grow border-t border-gray-300"}),(0,a.jsx)("span",{className:"flex-shrink mx-4 text-gray-500 text-lg",children:"OR"}),(0,a.jsx)("div",{className:"flex-grow border-t border-gray-300"})]}),(0,a.jsx)("input",{type:"text",placeholder:"Enter Game Code to Join",value:n,onChange:e=>r(e.target.value.toUpperCase()),className:"w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-purple-500 focus:border-purple-500 uppercase",maxLength:6}),(0,a.jsx)("button",{onClick:s,className:"w-full bg-indigo-600 text-white py-3 rounded-lg text-xl font-bold hover:bg-indigo-700 transition-colors shadow-md",children:"Join Existing Game"})]}),(0,a.jsx)("p",{className:"text-red-500 text-md mt-4",children:t})]})]})}},9843:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var a=n(7876),r=n(4232),l=n(157),s=n(2037),o=n(9475),c=n(1768);let i=["Head","Torso","Legs","Feet"];function u(){let e=(0,r.useRef)(null),[t,n]=(0,r.useState)(""),[u,d]=(0,r.useState)(""),[m,g]=(0,r.useState)(null),[p,x]=(0,r.useState)("Enter a game code to join or create one!"),[f,h]=(0,r.useState)(0),[w,S]=(0,r.useState)(0),[y,v]=(0,r.useState)(i[(w+1)%4]),[b,j]=(0,r.useState)(!1),[C,N]=(0,r.useState)(!1),[k,E]=(0,r.useState)(null),[W,O]=(0,r.useState)(null),[P,_]=(0,r.useState)(!1),[A,G]=(0,r.useState)(null),[I,L]=(0,r.useState)(null),[R,D]=(0,r.useState)(!1),[F,H]=(0,r.useState)(null),[J,M]=(0,r.useState)(0),[T,U]=(0,r.useState)(0),[Y,z]=(0,r.useState)(!1);(0,r.useEffect)(()=>{function e(){{let e,t,n=window.innerWidth-40,a=window.innerHeight-40,r=n/.5625;if(r<=a?(e=n,t=r):(t=a,e=.5625*a),e>1080||t>1920){let n=Math.min(1080/e,1920/t);e*=n,t*=n}M(Math.round(e)),U(Math.round(t))}}return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),(0,r.useEffect)(()=>{if(R&&!e.current){console.log("Attempting to establish WebSocket connection...");let a=new WebSocket(WS_URL);e.current=a;let r=u||t;return a.onopen=()=>{console.log("WebSocket connected. Sending joinGame message..."),a.send(JSON.stringify({type:"joinGame",gameCode:r,playerId:null}))},a.onmessage=e=>{let a=JSON.parse(e.data);console.log("Received from server:",a),x(a.message),h(a.playerCount||0),S(a.currentSegmentIndex||0),v(i[(a.currentSegmentIndex+1)%4]),j(a.canDraw&&2===a.playerCount&&!a.isWaitingForOthers),N(a.isWaitingForOthers||!1),g(a.gameRoomId||null),a.playerId&&a.playerId!==F&&H(a.playerId),a.hasOwnProperty("canvasData")&&null!==a.canvasData?E(a.canvasData):a.hasOwnProperty("canvasData")&&null===a.canvasData&&E(null),O(0===a.currentSegmentIndex?null:a.previousRedLineY||null),"completed"===a.status?(_(!0),G(a.finalArtwork1||null),L(a.finalArtwork2||null),j(!1),N(!1)):"playerDisconnected"===a.type&&(_(!1),G(null),L(null)),("initialState"===a.type||"gameStarted"===a.type)&&(n(a.gameCode||t),d(a.gameCode||u),N(a.isWaitingForOthers),E(a.canvasData),O(a.previousRedLineY||null),G(a.finalArtwork1||null),L(a.finalArtwork2||null),"completed"===a.status?_(!0):_(!1))},a.onclose=()=>{console.log("WebSocket disconnected. Attempting to reconnect..."),P?(x("Game session ended. Please play again."),H(null),e.current=null):(x("Connection lost. Attempting to reconnect..."),setTimeout(()=>{e.current=null,D(!1),D(!0)},2e3))},a.onerror=t=>{console.error("WebSocket error:",t),x("WebSocket error. Check console for details."),e.current=null,D(!1)},()=>{e.current&&e.current.readyState===WebSocket.OPEN&&(console.log("Cleaning up WebSocket connection..."),e.current.close()),e.current=null}}},[R,u,t,F]);let X=async()=>{try{z(!0);let e=await l.A.post("".concat(BASE_URL,"/api/createGame"),{});z(!1);let{gameCode:t}=e.data;d(t),n(""),x("Game created! Share this code: ".concat(t)),D(!0)}catch(e){console.error("Error creating game:",e),x("Failed to create game. Please try again.")}},q=(0,r.useCallback)(()=>{e.current&&e.current.readyState===WebSocket.OPEN&&e.current.close(),e.current=null,n(""),d(""),g(null),x("Enter a game code to join or create one!"),h(0),S(0),v(i[1]),j(!1),N(!1),E(null),O(null),_(!1),G(null),L(null),D(!1),H(null)},[]);return(0,a.jsx)("div",{className:"min-h-screen bg-indigo-100 flex flex-col items-center justify-center font-sans px-4 sm:px-8 ".concat(P?"":"overflow-hidden"),children:R?(0,a.jsx)(s.default,{gameRoomId:u||t,message:p,playerCount:f,currentSegmentIndex:w,canDrawOrPlaceLine:b,isWaitingForOtherPlayers:C,receivedCanvasImage:k,previousRedLineY:W,isGameOver:P,finalArtwork:A,finalArtwork2:I,currentPlayersWsId:F,wsRef:e,setMessage:x,setCanDrawOrPlaceLine:j,setIsWaitingForOtherPlayers:N,handlePlayAgain:q,dynamicCanvasWidth:J,dynamicCanvasHeight:T,backendCanvasHeight:1920}):(0,a.jsxs)(a.Fragment,{children:[Y&&(0,a.jsx)(c.default,{}),(0,a.jsx)(o.default,{message:p,gameCode:t,setGameCode:n,createNewGame:X,joinExistingGame:()=>{if(""===t.trim())return void x("Please enter a game code to join.");d(""),x("Attempting to join game ".concat(t,"...")),D(!0)}})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[157,37,636,593,792],()=>t(2898)),_N_E=e.O()}]);
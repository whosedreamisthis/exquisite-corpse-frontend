(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{1768:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});var a=n(7876);function r(){return(0,a.jsx)("div",{children:(0,a.jsx)("span",{className:"loader"})})}},2898:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(9843)}])},9475:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});var a=n(7876);function r(e){let{message:t,gameCode:n,setGameCode:r,createNewGame:l,joinExistingGame:s}=e;return(0,a.jsxs)("div",{className:"mx-4 sm:mx-8 w-full flex flex-col items-center",children:[" ",(0,a.jsx)("h1",{className:"text-5xl font-extrabold text-purple-800 mb-6 drop-shadow-lg text-center",children:"Exquisite Corpse Game"}),(0,a.jsxs)("div",{className:"bg-white p-8 rounded-2xl shadow-xl max-w-md w-full text-center space-y-6",children:[" ",(0,a.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-4",children:"Welcome!"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("button",{onClick:l,className:"w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-purple-500 focus:border-purple-500",children:"Create New Game"}),(0,a.jsxs)("div",{className:"relative flex items-center py-2",children:[(0,a.jsx)("div",{className:"flex-grow border-t border-gray-300"}),(0,a.jsx)("span",{className:"flex-shrink mx-4 text-gray-500 text-lg",children:"OR"}),(0,a.jsx)("div",{className:"flex-grow border-t border-gray-300"})]}),(0,a.jsx)("input",{type:"text",placeholder:"Enter Game Code to Join",value:n,onChange:e=>r(e.target.value.toUpperCase()),className:"w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-purple-500 focus:border-purple-500 uppercase",maxLength:6}),(0,a.jsx)("button",{onClick:s,className:"w-full bg-indigo-600 text-white py-3 rounded-lg text-xl font-bold hover:bg-indigo-700 transition-colors shadow-md",children:"Join Existing Game"})]}),(0,a.jsx)("p",{className:"text-red-500 text-md mt-4",children:t})]})]})}},9843:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var a=n(7876),r=n(4232),l=n(157),s=n(2037),o=n(9475),c=n(1768);let i=["Head","Torso","Legs","Feet"];function u(){let e=(0,r.useRef)(null),[t,n]=(0,r.useState)(""),[u,d]=(0,r.useState)(""),[m,g]=(0,r.useState)(null),[p,x]=(0,r.useState)("Enter a game code to join or create one!"),[h,f]=(0,r.useState)(0),[w,S]=(0,r.useState)(0),[y,b]=(0,r.useState)(i[(w+1)%4]),[v,C]=(0,r.useState)(!1),[j,k]=(0,r.useState)(!1),[N,W]=(0,r.useState)(null),[E,O]=(0,r.useState)(null),[P,I]=(0,r.useState)(!1),[G,A]=(0,r.useState)(null),[_,D]=(0,r.useState)(null),[L,R]=(0,r.useState)(!1),[F,H]=(0,r.useState)(null),[J,M]=(0,r.useState)(0),[T,Y]=(0,r.useState)(0),[z,X]=(0,r.useState)(!1);(0,r.useEffect)(()=>{function e(){{let e,t,n=window.innerWidth-40,a=window.innerHeight-40,r=n/.5625;if(r<=a?(e=n,t=r):(t=a,e=.5625*a),e>1080||t>1920){let n=Math.min(1080/e,1920/t);e*=n,t*=n}M(Math.round(e)),Y(Math.round(t))}}return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),(0,r.useEffect)(()=>{if(L&&!e.current){console.log("Attempting to establish WebSocket connection...");let a="".concat("wss://satin-lumbar-book.glitch.me","?playerId=").concat(F,"&gameCode=").concat(u||t);console.log("Connecting to WS:",a);let r=new WebSocket(a);e.current=r;let l=u||t;return r.onopen=()=>{console.log("WebSocket connected. Sending joinGame message..."),r.send(JSON.stringify({type:"joinGame",gameCode:l,playerId:null}))},r.onmessage=e=>{let a=JSON.parse(e.data);console.log("Received from server:",a),x(a.message),f(a.playerCount||0),S(a.currentSegmentIndex||0),b(i[(a.currentSegmentIndex+1)%4]),C(a.canDraw&&2===a.playerCount&&!a.isWaitingForOthers),k(a.isWaitingForOthers||!1),g(a.gameRoomId||null),a.playerId&&a.playerId!==F&&H(a.playerId),a.hasOwnProperty("canvasData")&&null!==a.canvasData?W(a.canvasData):a.hasOwnProperty("canvasData")&&null===a.canvasData&&W(null),O(0===a.currentSegmentIndex?null:a.previousRedLineY||null),"completed"===a.status?(I(!0),A(a.finalArtwork1||null),D(a.finalArtwork2||null),C(!1),k(!1)):"playerDisconnected"===a.type&&(I(!1),A(null),D(null)),("initialState"===a.type||"gameStarted"===a.type)&&(n(a.gameCode||t),d(a.gameCode||u),k(a.isWaitingForOthers),W(a.canvasData),O(a.previousRedLineY||null),A(a.finalArtwork1||null),D(a.finalArtwork2||null),"completed"===a.status?I(!0):I(!1))},r.onclose=()=>{console.log("WebSocket disconnected. Attempting to reconnect..."),P?(x("Game session ended. Please play again."),H(null),e.current=null):(x("Connection lost. Attempting to reconnect..."),H(null),e.current=null,setTimeout(()=>{R(!1),R(!0)},2e3))},r.onerror=t=>{console.error("WebSocket error:",t),x("WebSocket error. Check console for details."),e.current=null,R(!1)},()=>{e.current&&e.current.readyState===WebSocket.OPEN&&(console.log("Cleaning up WebSocket connection..."),e.current.close()),e.current=null}}},[L,u,t,F]);let q=async()=>{try{X(!0);let e=await l.A.post("".concat("https://satin-lumbar-book.glitch.me","/api/createGame"),{});X(!1);let{gameCode:t}=e.data;d(t),n(""),x("Game created! Share this code: ".concat(t)),R(!0)}catch(e){console.error("Error creating game:",e),x("Failed to create game. Please try again.")}},U=(0,r.useCallback)(()=>{e.current&&e.current.readyState===WebSocket.OPEN&&e.current.close(),e.current=null,n(""),d(""),g(null),x("Enter a game code to join or create one!"),f(0),S(0),b(i[1]),C(!1),k(!1),W(null),O(null),I(!1),A(null),D(null),R(!1),H(null)},[]);return(0,a.jsx)("div",{className:"min-h-screen bg-indigo-100 flex flex-col items-center justify-center font-sans px-4 sm:px-8 ".concat(P?"":"overflow-hidden"),children:L?(0,a.jsx)(s.default,{gameRoomId:u||t,message:p,playerCount:h,currentSegmentIndex:w,canDrawOrPlaceLine:v,isWaitingForOtherPlayers:j,receivedCanvasImage:N,previousRedLineY:E,isGameOver:P,finalArtwork:G,finalArtwork2:_,currentPlayersWsId:F,wsRef:e,setMessage:x,setCanDrawOrPlaceLine:C,setIsWaitingForOtherPlayers:k,handlePlayAgain:U,dynamicCanvasWidth:J,dynamicCanvasHeight:T,backendCanvasHeight:1920}):(0,a.jsxs)(a.Fragment,{children:[z&&(0,a.jsx)(c.default,{}),(0,a.jsx)(o.default,{message:p,gameCode:t,setGameCode:n,createNewGame:q,joinExistingGame:()=>{if(""===t.trim())return void x("Please enter a game code to join.");d(""),x("Attempting to join game ".concat(t,"...")),R(!0)}})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[157,37,636,593,792],()=>t(2898)),_N_E=e.O()}]);
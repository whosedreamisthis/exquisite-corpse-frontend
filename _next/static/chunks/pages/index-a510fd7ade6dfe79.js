(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{2898:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(9843)}])},9475:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});var r=a(7876);function n(e){let{message:t,gameCode:a,setGameCode:n,createNewGame:l,joinExistingGame:s}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h1",{className:"text-5xl font-extrabold text-purple-800 mb-6 drop-shadow-lg",children:"Exquisite Corpse Game"}),(0,r.jsxs)("div",{className:"bg-white p-8 rounded-2xl shadow-xl max-w-md w-full text-center space-y-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-4",children:"Welcome!"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("button",{onClick:l,className:"w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-purple-500 focus:border-purple-500",children:"Create New Game"}),(0,r.jsxs)("div",{className:"relative flex items-center py-2",children:[(0,r.jsx)("div",{className:"flex-grow border-t border-gray-300"}),(0,r.jsx)("span",{className:"flex-shrink mx-4 text-gray-500 text-lg",children:"OR"}),(0,r.jsx)("div",{className:"flex-grow border-t border-gray-300"})]}),(0,r.jsx)("input",{type:"text",placeholder:"Enter Game Code to Join",value:a,onChange:e=>n(e.target.value.toUpperCase()),className:"w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-purple-500 focus:border-purple-500 uppercase",maxLength:6}),(0,r.jsx)("button",{onClick:s,className:"w-full bg-indigo-600 text-white py-3 rounded-lg text-xl font-bold hover:bg-indigo-700 transition-colors shadow-md",children:"Join Existing Game"})]}),(0,r.jsx)("p",{className:"text-red-500 text-md mt-4",children:t})]})]})}},9843:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var r=a(7876),n=a(4232),l=a(157),s=a(2037),o=a(9475);let i=["Head","Torso","Legs","Feet"];function c(){let e=(0,n.useRef)(null),[t,a]=(0,n.useState)(""),[c,u]=(0,n.useState)(""),[d,m]=(0,n.useState)(null),[g,p]=(0,n.useState)("Enter a game code to join or create one!"),[x,h]=(0,n.useState)(0),[f,w]=(0,n.useState)(0),[b,S]=(0,n.useState)(i[(f+1)%4]),[y,v]=(0,n.useState)(!1),[j,C]=(0,n.useState)(!1),[k,N]=(0,n.useState)(null),[E,W]=(0,n.useState)(null),[O,P]=(0,n.useState)(!1),[G,I]=(0,n.useState)(null),[_,D]=(0,n.useState)(null),[A,L]=(0,n.useState)(!1),[R,F]=(0,n.useState)(null),[J,H]=(0,n.useState)(0),[T,Y]=(0,n.useState)(0);(0,n.useEffect)(()=>{function e(){H(window.innerWidth),Y(window.innerHeight)}return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),(0,n.useEffect)(()=>{if(A&&!e.current){console.log("Attempting to establish WebSocket connection...");let r=new WebSocket("https://satin-lumbar-book.glitch.me");e.current=r;let n=c||t;return r.onopen=()=>{console.log("WebSocket connected. Sending joinGame message..."),r.send(JSON.stringify({type:"joinGame",gameCode:n,playerId:null}))},r.onmessage=e=>{let r=JSON.parse(e.data);console.log("Received from server:",r),p(r.message),h(r.playerCount||0),w(r.currentSegmentIndex||0),S(i[(r.currentSegmentIndex+1)%4]),v(r.canDraw&&2===r.playerCount&&!r.isWaitingForOthers),C(r.isWaitingForOthers||!1),m(r.gameRoomId||null),r.playerId&&r.playerId!==R&&F(r.playerId),r.hasOwnProperty("canvasData")&&null!==r.canvasData?N(r.canvasData):r.hasOwnProperty("canvasData")&&null===r.canvasData&&N(null),W(0===r.currentSegmentIndex?null:r.previousRedLineY||null),"completed"===r.status?(P(!0),I(r.finalArtwork1||null),D(r.finalArtwork2||null),v(!1),C(!1)):"playerDisconnected"===r.type&&(P(!1),I(null),D(null)),("initialState"===r.type||"gameStarted"===r.type)&&(a(r.gameCode||t),u(r.gameCode||c),C(r.isWaitingForOthers),N(r.canvasData),W(r.previousRedLineY||null),I(r.finalArtwork1||null),D(r.finalArtwork2||null),"completed"===r.status?P(!0):P(!1))},r.onclose=()=>{console.log("WebSocket disconnected."),p("Disconnected from game. Please create or rejoin a game."),L(!1),F(null),e.current=null},r.onerror=t=>{console.error("WebSocket error:",t),p("WebSocket error. Check console for details."),e.current=null,L(!1)},()=>{e.current&&e.current.readyState===WebSocket.OPEN&&(console.log("Cleaning up WebSocket connection..."),e.current.close()),e.current=null}}},[A,c,t,R]);let q=async()=>{try{let{gameCode:e}=(await l.A.post("http://localhost:8080/api/createGame",{})).data;u(e),a(""),p("Game created! Share this code: ".concat(e)),L(!0)}catch(e){console.error("Error creating game:",e),p("Failed to create game. Please try again.")}},z=(0,n.useCallback)(()=>{e.current&&e.current.readyState===WebSocket.OPEN&&e.current.close(),e.current=null,a(""),u(""),m(null),p("Enter a game code to join or create one!"),h(0),w(0),S(i[1]),v(!1),C(!1),N(null),W(null),P(!1),I(null),D(null),L(!1),F(null)},[]);return(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-100 to-indigo-200 flex flex-col items-center justify-center font-sans",children:[!A&&(0,r.jsx)("h1",{className:"text-5xl font-extrabold text-purple-800 mb-6 drop-shadow-lg",children:"Exquisite Corpse Game"}),A?(0,r.jsx)(s.default,{gameRoomId:c||t,message:g,playerCount:x,currentSegmentIndex:f,canDrawOrPlaceLine:y,isWaitingForOtherPlayers:j,receivedCanvasImage:k,previousRedLineY:E,isGameOver:O,finalArtwork:G,finalArtwork2:_,currentPlayersWsId:R,wsRef:e,setMessage:p,setCanDrawOrPlaceLine:v,setIsWaitingForOtherPlayers:C,handlePlayAgain:z,dynamicCanvasWidth:J,dynamicCanvasHeight:T}):(0,r.jsx)(o.default,{message:g,gameCode:t,setGameCode:a,createNewGame:q,joinExistingGame:()=>{if(""===t.trim())return void p("Please enter a game code to join.");u(""),p("Attempting to join game ".concat(t,"...")),L(!0)}})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[157,37,636,593,792],()=>t(2898)),_N_E=e.O()}]);
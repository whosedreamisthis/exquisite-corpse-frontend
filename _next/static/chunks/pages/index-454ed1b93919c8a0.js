(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{1768:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});var n=a(7876);function r(){return(0,n.jsx)("div",{children:(0,n.jsx)("span",{className:"loader"})})}},2898:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(9843)}])},9475:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});var n=a(7876);function r(e){let{message:t,gameCode:a,setGameCode:r,createNewGame:l,joinExistingGame:s}=e;return(0,n.jsxs)("div",{className:"mx-4 sm:mx-8 w-full flex flex-col items-center",children:[" ",(0,n.jsx)("h1",{className:"text-5xl font-extrabold text-purple-800 mb-6 drop-shadow-lg text-center",children:"Exquisite Corpse Game"}),(0,n.jsxs)("div",{className:"bg-white p-8 rounded-2xl shadow-xl max-w-md w-full text-center space-y-6",children:[" ",(0,n.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-4",children:"Welcome!"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("button",{onClick:l,className:"w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-purple-500 focus:border-purple-500",children:"Create New Game"}),(0,n.jsxs)("div",{className:"relative flex items-center py-2",children:[(0,n.jsx)("div",{className:"flex-grow border-t border-gray-300"}),(0,n.jsx)("span",{className:"flex-shrink mx-4 text-gray-500 text-lg",children:"OR"}),(0,n.jsx)("div",{className:"flex-grow border-t border-gray-300"})]}),(0,n.jsx)("input",{type:"text",placeholder:"Enter Game Code to Join",value:a,onChange:e=>r(e.target.value.toUpperCase()),className:"w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-purple-500 focus:border-purple-500 uppercase",maxLength:6}),(0,n.jsx)("button",{onClick:s,className:"w-full bg-indigo-600 text-white py-3 rounded-lg text-xl font-bold hover:bg-indigo-700 transition-colors shadow-md",children:"Join Existing Game"})]}),(0,n.jsx)("p",{className:"text-red-500 text-md mt-4",children:t})]})]})}},9843:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var n=a(7876),r=a(4232),l=a(157),s=a(2037),o=a(9475),c=a(1768);let i=["Head","Torso","Legs","Feet"];function u(){let e=(0,r.useRef)(null),[t,a]=(0,r.useState)(""),[u,d]=(0,r.useState)(""),[m,g]=(0,r.useState)(null),[x,p]=(0,r.useState)("Enter a game code to join or create one!"),[f,h]=(0,r.useState)(0),[w,S]=(0,r.useState)(0),[b,v]=(0,r.useState)(i[(w+1)%4]),[y,j]=(0,r.useState)(!1),[k,C]=(0,r.useState)(!1),[N,E]=(0,r.useState)(null),[W,O]=(0,r.useState)(null),[P,I]=(0,r.useState)(!1),[G,_]=(0,r.useState)(null),[D,A]=(0,r.useState)(null),[L,R]=(0,r.useState)(!1),[F,H]=(0,r.useState)(null),[J,M]=(0,r.useState)(0),[T,Y]=(0,r.useState)(0),[z,X]=(0,r.useState)(!1);(0,r.useEffect)(()=>{function e(){{let e,t,a=window.innerWidth-40,n=window.innerHeight-40,r=a/.5625;if(r<=n?(e=a,t=r):(t=n,e=.5625*n),e>1080||t>1920){let a=Math.min(1080/e,1920/t);e*=a,t*=a}M(Math.round(e)),Y(Math.round(t))}}return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),(0,r.useEffect)(()=>{if(L&&!e.current){console.log("Attempting to establish WebSocket connection...");let n=new WebSocket("wss://satin-lumbar-book.glitch.me");e.current=n;let r=u||t;return n.onopen=()=>{console.log("WebSocket connected. Sending joinGame message..."),n.send(JSON.stringify({type:"joinGame",gameCode:r,playerId:null}))},n.onmessage=e=>{let n=JSON.parse(e.data);console.log("Received from server:",n),p(n.message),h(n.playerCount||0),S(n.currentSegmentIndex||0),v(i[(n.currentSegmentIndex+1)%4]),j(n.canDraw&&2===n.playerCount&&!n.isWaitingForOthers),C(n.isWaitingForOthers||!1),g(n.gameRoomId||null),n.playerId&&n.playerId!==F&&H(n.playerId),n.hasOwnProperty("canvasData")&&null!==n.canvasData?E(n.canvasData):n.hasOwnProperty("canvasData")&&null===n.canvasData&&E(null),O(0===n.currentSegmentIndex?null:n.previousRedLineY||null),"completed"===n.status?(I(!0),_(n.finalArtwork1||null),A(n.finalArtwork2||null),j(!1),C(!1)):"playerDisconnected"===n.type&&(I(!1),_(null),A(null)),("initialState"===n.type||"gameStarted"===n.type)&&(a(n.gameCode||t),d(n.gameCode||u),C(n.isWaitingForOthers),E(n.canvasData),O(n.previousRedLineY||null),_(n.finalArtwork1||null),A(n.finalArtwork2||null),"completed"===n.status?I(!0):I(!1))},n.onclose=()=>{console.log("WebSocket disconnected."),p("Disconnected from game. Please create or rejoin a game."),R(!1),H(null),e.current=null},n.onerror=t=>{console.error("WebSocket error:",t),p("WebSocket error. Check console for details."),e.current=null,R(!1)},()=>{e.current&&e.current.readyState===WebSocket.OPEN&&(console.log("Cleaning up WebSocket connection..."),e.current.close()),e.current=null}}},[L,u,t,F]);let q=async()=>{try{X(!0);let e=await l.A.post("".concat("https://satin-lumbar-book.glitch.me","/api/createGame"),{});X(!1);let{gameCode:t}=e.data;d(t),a(""),p("Game created! Share this code: ".concat(t)),R(!0)}catch(e){console.error("Error creating game:",e),p("Failed to create game. Please try again.")}},U=(0,r.useCallback)(()=>{e.current&&e.current.readyState===WebSocket.OPEN&&e.current.close(),e.current=null,a(""),d(""),g(null),p("Enter a game code to join or create one!"),h(0),S(0),v(i[1]),j(!1),C(!1),E(null),O(null),I(!1),_(null),A(null),R(!1),H(null)},[]);return(0,n.jsx)("div",{className:"min-h-screen bg-indigo-100 flex flex-col items-center justify-center font-sans px-4 sm:px-8 ".concat(P?"":"overflow-hidden"),children:L?(0,n.jsx)(s.default,{gameRoomId:u||t,message:x,playerCount:f,currentSegmentIndex:w,canDrawOrPlaceLine:y,isWaitingForOtherPlayers:k,receivedCanvasImage:N,previousRedLineY:W,isGameOver:P,finalArtwork:G,finalArtwork2:D,currentPlayersWsId:F,wsRef:e,setMessage:p,setCanDrawOrPlaceLine:j,setIsWaitingForOtherPlayers:C,handlePlayAgain:U,dynamicCanvasWidth:J,dynamicCanvasHeight:T,backendCanvasHeight:1920}):(0,n.jsxs)(n.Fragment,{children:[z&&(0,n.jsx)(c.default,{}),(0,n.jsx)(o.default,{message:x,gameCode:t,setGameCode:a,createNewGame:q,joinExistingGame:()=>{if(""===t.trim())return void p("Please enter a game code to join.");d(""),p("Attempting to join game ".concat(t,"...")),R(!0)}})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[157,37,636,593,792],()=>t(2898)),_N_E=e.O()}]);
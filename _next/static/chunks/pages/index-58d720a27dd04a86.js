(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{2898:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(9843)}])},9475:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});var n=a(7876);function r(e){let{message:t,gameCode:a,setGameCode:r,createNewGame:l,joinExistingGame:o}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h1",{className:"text-5xl font-extrabold text-purple-800 mb-6 drop-shadow-lg",children:"Exquisite Corpse Game"}),(0,n.jsxs)("div",{className:"bg-white p-8 rounded-2xl shadow-xl max-w-md w-full text-center space-y-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-4",children:"Welcome!"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("button",{onClick:l,className:"w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-purple-500 focus:border-purple-500",children:"Create New Game"}),(0,n.jsxs)("div",{className:"relative flex items-center py-2",children:[(0,n.jsx)("div",{className:"flex-grow border-t border-gray-300"}),(0,n.jsx)("span",{className:"flex-shrink mx-4 text-gray-500 text-lg",children:"OR"}),(0,n.jsx)("div",{className:"flex-grow border-t border-gray-300"})]}),(0,n.jsx)("input",{type:"text",placeholder:"Enter Game Code to Join",value:a,onChange:e=>r(e.target.value.toUpperCase()),className:"w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-purple-500 focus:border-purple-500 uppercase",maxLength:6}),(0,n.jsx)("button",{onClick:o,className:"w-full bg-indigo-600 text-white py-3 rounded-lg text-xl font-bold hover:bg-indigo-700 transition-colors shadow-md",children:"Join Existing Game"})]}),(0,n.jsx)("p",{className:"text-red-500 text-md mt-4",children:t})]})]})}},9843:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var n=a(7876),r=a(4232),l=a(157),o=a(2037),s=a(9475);let c=["Head","Torso","Legs","Feet"];function i(){let e=(0,r.useRef)(null),[t,a]=(0,r.useState)(""),[i,u]=(0,r.useState)(""),[d,m]=(0,r.useState)(null),[g,p]=(0,r.useState)("Enter a game code to join or create one!"),[x,f]=(0,r.useState)(0),[h,w]=(0,r.useState)(0),[b,S]=(0,r.useState)(c[(h+1)%4]),[y,v]=(0,r.useState)(!1),[k,j]=(0,r.useState)(!1),[C,N]=(0,r.useState)(null),[E,W]=(0,r.useState)(null),[O,P]=(0,r.useState)(!1),[I,G]=(0,r.useState)(null),[_,D]=(0,r.useState)(null),[A,L]=(0,r.useState)(!1),[R,F]=(0,r.useState)(null),[J,H]=(0,r.useState)(0),[T,Y]=(0,r.useState)(0);(0,r.useEffect)(()=>{function e(){H(window.innerWidth),Y(window.innerHeight)}return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),(0,r.useEffect)(()=>{if(A&&!e.current){console.log("Attempting to establish WebSocket connection...");let n=new WebSocket("wss://satin-lumbar-book.glitch.me");e.current=n;let r=i||t;return n.onopen=()=>{console.log("WebSocket connected. Sending joinGame message..."),n.send(JSON.stringify({type:"joinGame",gameCode:r,playerId:null}))},n.onmessage=e=>{let n=JSON.parse(e.data);console.log("Received from server:",n),p(n.message),f(n.playerCount||0),w(n.currentSegmentIndex||0),S(c[(n.currentSegmentIndex+1)%4]),v(n.canDraw&&2===n.playerCount&&!n.isWaitingForOthers),j(n.isWaitingForOthers||!1),m(n.gameRoomId||null),n.playerId&&n.playerId!==R&&F(n.playerId),n.hasOwnProperty("canvasData")&&null!==n.canvasData?N(n.canvasData):n.hasOwnProperty("canvasData")&&null===n.canvasData&&N(null),W(0===n.currentSegmentIndex?null:n.previousRedLineY||null),"completed"===n.status?(P(!0),G(n.finalArtwork1||null),D(n.finalArtwork2||null),v(!1),j(!1)):"playerDisconnected"===n.type&&(P(!1),G(null),D(null)),("initialState"===n.type||"gameStarted"===n.type)&&(a(n.gameCode||t),u(n.gameCode||i),j(n.isWaitingForOthers),N(n.canvasData),W(n.previousRedLineY||null),G(n.finalArtwork1||null),D(n.finalArtwork2||null),"completed"===n.status?P(!0):P(!1))},n.onclose=()=>{console.log("WebSocket disconnected."),p("Disconnected from game. Please create or rejoin a game."),L(!1),F(null),e.current=null},n.onerror=t=>{console.error("WebSocket error:",t),p("WebSocket error. Check console for details."),e.current=null,L(!1)},()=>{e.current&&e.current.readyState===WebSocket.OPEN&&(console.log("Cleaning up WebSocket connection..."),e.current.close()),e.current=null}}},[A,i,t,R]);let z=async()=>{try{let{gameCode:e}=(await l.A.post("".concat("https://satin-lumbar-book.glitch.me","/api/createGame"),{})).data;u(e),a(""),p("Game created! Share this code: ".concat(e)),L(!0)}catch(e){console.error("Error creating game:",e),p("Failed to create game. Please try again.")}},X=(0,r.useCallback)(()=>{e.current&&e.current.readyState===WebSocket.OPEN&&e.current.close(),e.current=null,a(""),u(""),m(null),p("Enter a game code to join or create one!"),f(0),w(0),S(c[1]),v(!1),j(!1),N(null),W(null),P(!1),G(null),D(null),L(!1),F(null)},[]);return(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-100 to-indigo-200 flex flex-col items-center justify-center font-sans  ".concat(O?"":"overflow-hidden"),children:A?(0,n.jsx)(o.default,{gameRoomId:i||t,message:g,playerCount:x,currentSegmentIndex:h,canDrawOrPlaceLine:y,isWaitingForOtherPlayers:k,receivedCanvasImage:C,previousRedLineY:E,isGameOver:O,finalArtwork:I,finalArtwork2:_,currentPlayersWsId:R,wsRef:e,setMessage:p,setCanDrawOrPlaceLine:v,setIsWaitingForOtherPlayers:j,handlePlayAgain:X,dynamicCanvasWidth:J,dynamicCanvasHeight:T}):(0,n.jsx)(s.default,{message:g,gameCode:t,setGameCode:a,createNewGame:z,joinExistingGame:()=>{if(""===t.trim())return void p("Please enter a game code to join.");u(""),p("Attempting to join game ".concat(t,"...")),L(!0)}})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[157,37,636,593,792],()=>t(2898)),_N_E=e.O()}]);
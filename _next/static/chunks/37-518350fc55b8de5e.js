"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[37],{2037:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});var r=n(7876),l=n(4232),o=n(2467),s=n(7378);function a(e){let{gameRoomId:t,message:n,playerCount:a,currentSegmentIndex:i,canDrawOrPlaceLine:c,isWaitingForOtherPlayers:u,receivedCanvasImage:d,previousRedLineY:h,isGameOver:g,finalArtwork:b,finalArtwork2:f,currentPlayersWsId:m,wsRef:x,setMessage:w,handlePlayAgain:p,dynamicCanvasWidth:v,dynamicCanvasHeight:k,backendCanvasHeight:y,setCanDrawOrPlaceLine:j,setIsWaitingForOtherPlayers:C}=e,S=(0,l.useRef)(null),N=(0,l.useRef)(null),L=(0,l.useRef)(null),D=(0,l.useRef)(null),R=(0,l.useRef)(!1),M=(0,l.useRef)({x:0,y:0}),W=(0,l.useRef)([]),O=(0,l.useRef)({}),[E,P]=(0,l.useState)(!1),[z,F]=(0,l.useState)(k),T=3===i,[A,Y]=(0,l.useState)(null),[I,J]=(0,l.useState)([]),[U,B]=(0,l.useState)([]),H=I.length>0;(0,l.useEffect)(()=>{if(console.log("[Overlay Debug] Effect triggered for previousRedLineY scaling."),console.log("[Overlay Debug] Raw previousRedLineY from backend: ".concat(h)),console.log("[Overlay Debug] Current dynamicCanvasHeight: ".concat(k)),console.log("[Overlay Debug] Backend original CanvasHeight: ".concat(y)),null!==h&&y&&k){let e=k/y,t=h*e;Y(t),console.log("[Overlay Debug] Calculated scaleFactor: ".concat(e)),console.log("[Overlay Debug] Scaled previousRedLineY: ".concat(t))}else Y(null),console.log("[Overlay Debug] previousRedLineY is null or dimensions missing, not applying overlay.")},[h,y,k]);let _=(0,l.useCallback)(()=>{let e=N.current,t=S.current;if(e&&t)if(e.clearRect(0,0,v,k),e.fillStyle="white",e.fillRect(0,0,v,k),d){let t=new Image;t.onload=()=>{N.current&&S.current.width===v&&(N.current.drawImage(t,0,0,v,k),I.forEach(t=>{G(e,t,v,k)}))},t.onerror=e=>{console.error("Error loading received canvas image for redraw:",e)},t.src=d}else I.forEach(t=>{G(e,t,v,k)})},[v,k,d,I]),G=(0,l.useCallback)((e,t)=>{if(e&&t&&t.points&&0!==t.points.length){e.strokeStyle=t.color,e.lineWidth=t.lineWidth,e.lineCap=t.lineCap||"round",e.lineJoin=t.lineJoin||"round",e.beginPath(),e.moveTo(t.points[0].x,t.points[0].y);for(let n=1;n<t.points.length;n++)e.lineTo(t.points[n].x,t.points[n].y);e.stroke()}},[]);(0,l.useEffect)(()=>{let e=S.current,t=L.current,n=N.current,r=D.current;if(!e||!t)return;e.width=v,e.height=k,t.width=v,t.height=k,n||((n=e.getContext("2d")).lineCap="round",n.lineJoin="round",n.strokeStyle="black",N.current=n),r||((r=t.getContext("2d")).lineCap="round",r.lineJoin="round",r.strokeStyle="black",D.current=r);let l=k/y;n.lineWidth=5*l,r.lineWidth=5*l,r.clearRect(0,0,v,k),_()},[v,k,y,_]),(0,l.useEffect)(()=>{_()},[I,d,_]);let X=(0,l.useCallback)(e=>{let t=L.current,n=D.current;t&&n&&(n.clearRect(0,0,t.width,t.height),n.strokeStyle="red",n.lineWidth=2,n.beginPath(),n.moveTo(0,e),n.lineTo(t.width,e),n.stroke(),n.closePath())},[]),q=(0,l.useCallback)(()=>{let e=L.current,t=D.current;e&&t&&t.clearRect(0,0,e.width,e.height)},[]),K=(0,l.useCallback)((e,t)=>{let n,r;e.preventDefault();let l=t.getBoundingClientRect(),o=t.width/l.width,s=t.height/l.height;return e.touches&&e.touches.length>0?(n=e.touches[0].clientX,r=e.touches[0].clientY):(n=e.clientX,r=e.clientY),{x:(n-l.left)*o,y:(r-l.top)*s}},[]),Q=(0,l.useCallback)(e=>{if(!c||g)return;e.preventDefault();let t=L.current;if(!t)return;let{x:n,y:r}=K(e,t);i>0&&null!==A&&r<A||(R.current=!0,M.current={x:n,y:r},E||(W.current=[{x:n,y:r}],O.current={color:N.current.strokeStyle,lineWidth:N.current.lineWidth,lineCap:N.current.lineCap,lineJoin:N.current.lineJoin},D.current.beginPath(),D.current.moveTo(n,r)))},[c,g,E,K,i,A]),V=(0,l.useCallback)(e=>{if(!R.current||!c||g)return;e.preventDefault();let t=L.current;if(!t)return;let{x:n,y:r}=K(e,t);if(!(i>0)||null===A||!(r<A)){if(E){let e=Math.max(0,Math.min(k,r));F(e),X(e)}else D.current.lineTo(n,r),D.current.stroke(),W.current.push({x:n,y:r});M.current={x:n,y:r}}},[c,g,E,X,K,k,i,A]),Z=(0,l.useCallback)(()=>{if(c&&!g&&R.current){if(!E&&(D.current.closePath(),D.current.clearRect(0,0,v,k),W.current.length>=2)){let e={...O.current,points:[...W.current]};J(t=>[...t,e]),B([])}R.current=!1,W.current=[]}},[c,g,E,v,k]),$=(0,l.useCallback)(()=>{R.current&&!E?Z():E&&R.current&&(R.current=!1)},[E,Z]),ee=(0,l.useCallback)(()=>{J(e=>{if(e.length>0){let t=e[e.length-1];return B(e=>[...e,t]),e.slice(0,e.length-1)}return e})},[]),et=(0,l.useCallback)(()=>{B(e=>{if(e.length>0){let t=e[e.length-1];return J(e=>[...e,t]),e.slice(0,e.length-1)}return e})},[]),en=(0,l.useCallback)(()=>{if(3!==i){if(!H)return void w("Please draw something before marking as Done.");R.current=!1,N.current,P(!0),F(k/2),X(k/2)}},[X,i,k,H,w]),er=c&&!u&&!g&&(E||T&&H);return(0,r.jsxs)("div",{className:"w-full max-w-3xl flex flex-col items-center relative",children:[" ",g?(0,r.jsx)(s.default,{finalArtwork:b,finalArtwork2:f,dynamicCanvasWidth:v,dynamicCanvasHeight:k,handlePlayAgain:p}):(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"relative bg-gray-100 rounded-lg shadow-inner overflow-hidden m-[5px]",style:{width:v,height:k},children:[(0,r.jsx)("canvas",{ref:S,className:"absolute top-0 left-0 w-full h-full rounded-lg border-2 border-solid border-gray-400 box-border",style:{zIndex:0}}),(0,r.jsx)("div",{className:"absolute top-1 left-2 p-2 rounded-lg text-gray-800 text-lg font-medium bg-opacity-75 z-40",style:{},children:n}),(0,r.jsx)("div",{className:"absolute top-0 left-0 w-full h-full",style:{width:v,height:k,pointerEvents:"none",zIndex:1},children:d&&i>0&&null!==A&&(0,r.jsx)("div",{className:"absolute top-0 left-0 w-full bg-indigo-300 bg-opacity-75 flex items-center justify-center text-gray-800 text-xl font-semibold",style:{height:"".concat(A,"px"),pointerEvents:"none",overflow:"hidden"},children:"Hidden"})}),(0,r.jsx)("canvas",{ref:L,onMouseDown:Q,onMouseMove:V,onMouseUp:Z,onMouseOut:$,onTouchStart:Q,onTouchMove:V,onTouchEnd:Z,onTouchCancel:Z,className:"relative w-full h-full rounded-lg border-2 border-solid border-gray-400 box-border ".concat(c?"cursor-crosshair":"cursor-not-allowed"," touch-none"),style:{zIndex:2}}),u&&(0,r.jsxs)("div",{className:"absolute inset-0 bg-black bg-opacity-70 flex items-center justify-center rounded-lg text-white text-3xl font-bold text-center p-4 z-30",children:["Submitted!",(0,r.jsx)("br",{}),"Waiting for other player to submit their segment..."]}),(0,r.jsx)("div",{className:"absolute bottom-2 right-2 z-40 flex space-x-2",children:(0,r.jsx)(o.default,{handleUndo:ee,handleRedo:et,isGameOver:g,canDrawOrPlaceLine:c,handleDoneDrawing:en,isLastSegment:T,canSubmitSegment:er,submitSegment:()=>{if(!x.current||x.current.readyState!==WebSocket.OPEN)return void w("WebSocket not connected. Cannot submit.");if(!c||u||g||!E&&!T&&!H||!H&&!E&&!T)return void w("Cannot submit: Not your turn, game over, or conditions not met.");let e=S.current.toDataURL("image/png"),n=null;if(!T&&null!==z){let e=y/k;n=Math.round(z*e),console.log("[Submit Debug] Frontend redLineY: ".concat(z)),console.log("[Submit Debug] Scale factor to backend: ".concat(e)),console.log("[Submit Debug] Normalized redLineY sent to backend: ".concat(n))}x.current.send(JSON.stringify({type:"submitSegment",gameRoomId:t,canvasData:e,redLineY:n,playerId:m})),R.current=!1,C(!0),j(!1),J([]),B([]),P(!1),F(k),q()},isPlacingRedLine:E,isWaitingForOtherPlayers:u,hasDrawnSomething:H,isDrawing:R.current,hasUndoneStrokes:U.length>0})})]})})]})}},2467:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var r=n(7876);function l(e){let{handleUndo:t,handleRedo:n,isGameOver:l,canDrawOrPlaceLine:o,handleDoneDrawing:s,isLastSegment:a,canSubmitSegment:i,submitSegment:c,isPlacingRedLine:u,isWaitingForOtherPlayers:d,hasDrawnSomething:h,isDrawing:g,hasUndoneStrokes:b}=e;return(0,r.jsxs)("div",{className:"game-buttons-container",children:[(0,r.jsxs)("button",{onClick:t,className:"px-2 py-2 text-sm font-bold rounded-lg transition-all duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center\n                                ".concat(!o||l||!h||u||g?"bg-gray-400 cursor-not-allowed shadow-inner":"bg-orange-500 text-white shadow-lg hover:bg-orange-600"),disabled:!o||l||!h||u||g,title:"Undo Last Stroke",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-7 h-7",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"})}),(0,r.jsx)("span",{className:"sr-only",children:"Undo"})]}),(0,r.jsxs)("button",{onClick:n,className:"px-2 py-2 text-sm font-bold rounded-lg transition-all duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center\n                                ".concat(!o||l||!b||u||g?"bg-gray-400 cursor-not-allowed shadow-inner":"bg-purple-500 text-white shadow-lg hover:bg-purple-600"),disabled:!o||l||!b||u||g,title:"Redo Last Undone Stroke",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-7 h-7",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9l6 6m0 0l-6 6m6-6H9a6 6 0 010-12h3"})}),(0,r.jsx)("span",{className:"sr-only",children:"Redo"})]}),!a&&!u&&(0,r.jsxs)("button",{onClick:s,className:"px-2 py-2 text-lg font-bold rounded-lg transition-all duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center\n                                        ".concat(!o||d||l||!h||g?"bg-gray-400 cursor-not-allowed shadow-inner":"bg-blue-600 text-white shadow-lg hover:bg-blue-700"),disabled:!o||d||l||!h||g,title:"Done Drawing",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-7 h-7",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsx)("span",{className:"sr-only",children:"Done Drawing"})," "]}),(u||a)&&(0,r.jsxs)("button",{onClick:c,className:"px-3 py-3 text-lg font-bold rounded-lg transition-all duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center\n                                        ".concat(i?"bg-green-600 text-white shadow-lg hover:bg-green-700":"bg-gray-400 cursor-not-allowed shadow-inner"),disabled:!i,title:a?"Submit Final Artwork":"Submit Segment",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-7 h-7",children:a?(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}):(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})}),(0,r.jsx)("span",{className:"sr-only",children:a?"Submit Final Artwork":"Submit Segment"})]})]})}},7378:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var r=n(7876);function l(e){let{finalArtwork:t,finalArtwork2:n,handlePlayAgain:l,dynamicCanvasWidth:o,dynamicCanvasHeight:s}=e;return(0,r.jsxs)("div",{className:"text-center mt-5",children:[(0,r.jsx)("h2",{className:"text-4xl font-extrabold text-purple-700 my-4 animate-bounce",children:"Game Over!"}),(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-8 mb-8",children:[t&&(0,r.jsx)("img",{src:t,alt:"Final Combined Artwork 1",className:"bg-white border-4 border-purple-500 rounded-xl shadow-2xl block",style:{width:o,height:s,objectFit:"contain"}}),n&&(0,r.jsx)("img",{src:n,alt:"Final Combined Artwork 2",className:"bg-white border-4 border-purple-500 rounded-xl shadow-2xl block",style:{width:o,height:s,objectFit:"contain"}})]}),(0,r.jsx)("button",{onClick:l,className:"px-8 py-4 mb-8 text-xl font-bold rounded-lg bg-blue-600 text-white shadow-lg hover:bg-blue-700 transition-colors transform hover:scale-105",children:"Play Again"})]})}}}]);